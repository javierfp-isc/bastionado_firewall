#Lista de paquetes de utilidades de la imagen
PACKS="vim curl iputils-ping net-tools nano wget procps iptables traceroute dnsutils make gcc libpcre3-dev zlib1g-dev libluajit-5.1-dev libpcap-dev openssl libssl-dev libnghttp2-dev libdumbnet-dev bison flex libdnet autoconf libtool"

#Vaciamos tabla de enrutamiento y creamos rutas en el archivo /etc/routes, instalamos snort y descargamos community-rules
COMMANDS="DEBIAN_FRONTEND=noninteractive apt install -y iptables-persistent,echo \"ip route del default\">>/etc/routes,echo \"ip route add 192.168.110.0/24 via 192.168.120.202\">>/etc/routes,echo \"ip route add 192.168.111.0/24 via 192.168.120.202\">>/etc/routes,echo \"ip route add 192.168.112.0/24 via 192.168.120.202\">>/etc/routes,echo \"ip route add default via 192.168.200.1\">>/etc/routes,echo \"iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE\">>/etc/routes,cd /tmp && wget https://www.snort.org/downloads/snort/daq-2.0.7.tar.gz && tar -xvzf daq-2.0.7.tar.gz && cd daq-2.0.7 && ./configure --disable-dependency-tracking && autoreconf -f -i && make && make install,cd /tmp && wget https://www.snort.org/downloads/snort/snort-2.9.18.tar.gz && tar -xvzf snort-2.9.18.tar.gz && cd snort-2.9.18 && ./configure --enable-sourcefire && make && make install,ldconfig,ln -s /usr/local/bin/snort /usr/sbin/snort,groupadd snort,useradd snort -r -s /sbin/nologin -c SNORT_IDS -g snort,mkdir -p /etc/snort/rules /var/log/snort /usr/local/lib/snort_dynamicrules,chown -R snort:snort /etc/snort,chown -R snort:snort /var/log/snort,chown -R snort:snort /usr/local/lib/snort_dynamicrules,touch /etc/snort/rules/white_list.rules,touch /etc/snort/rules/black_list.rules,touch /etc/snort/rules/local.rules,cp /tmp/snort-2.9.18/etc/*.conf* /etc/snort,cp /tmp/snort-2.9.18/etc/*.map /etc/snort,cd /tmp && wget https://www.snort.org/rules/community -O community.tar.gz && tar -xvf community.tar.gz && cp community-rules/* /etc/snort/rules,sed -i 's/include \$RULE\_PATH/#include \$RULE\_PATH/' /etc/snort/snort.conf,sed -i 's/HOME_NET any/HOME_NET 192.168.200.203\/32/' /etc/snort/snort.conf,sed -i 's/EXTERNAL_NET any/EXTERNAL_NET !\$HOME_NET/' /etc/snort/snort.conf,sed -i 's/var RULE_PATH ../var RULE_PATH \/etc\/snort/' /etc/snort/snort.conf,sed -i 's/var SO_RULE_PATH ../var SO_RULE_PATH \/etc\/snort/' /etc/snort/snort.conf,sed -i 's/var PREPROC_RULE_PATH ../var PREPROC_RULE_PATH \/etc\/snort/' /etc/snort/snort.conf,sed -i 's/var WHITE_LIST_PATH ../var WHITE_LIST_PATH \/etc\/snort/' /etc/snort/snort.conf,sed -i 's/var BLACK_LIST_PATH ../var BLACK_LIST_PATH \/etc\/snort/' /etc/snort/snort.conf,echo output unified2: filename snort.log >> /etc/snort/snort.conf,echo 'include \$RULE_PATH/local.rules' >> /etc/snort/snort.conf,echo 'include \$RULE_PATH/community.rules' >> /etc/snort/snort.conf"
